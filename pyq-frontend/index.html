<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ‹å‹åœˆè‡ªåŠ¨å‘å¸ƒç³»ç»Ÿ - ç®¡ç†åå°</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ant-design-vue@4/dist/reset.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ant-design-vue@4/dist/antd.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ant-design-vue@4/dist/reset.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f0f2f5;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* ä¾§è¾¹æ æ ·å¼ - æ¸…çˆ½ç™½è‰²é£æ ¼ */
        .sidebar {
            width: 256px;
            background: white;
            border-right: 1px solid #e8e8e8;
            display: flex;
            flex-direction: column;
        }

        .logo {
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #0052CC;
            background: white;
            border-bottom: 1px solid #e8e8e8;
        }

        .menu {
            flex: 1;
            padding: 16px 0;
        }

        .menu-item {
            padding: 12px 24px;
            margin: 4px 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #666;
            border-radius: 8px;
        }

        .menu-item:hover {
            background: #E6F4FF;
            color: #0052CC;
        }

        .menu-item.active {
            background: #0052CC;
            color: white;
        }

        .menu-icon {
            font-size: 18px;
        }

        /* åˆ†çº§èœå•æ ·å¼ */
        .menu-group {
            margin: 4px 0;
        }

        .menu-group-title {
            padding: 12px 24px;
            margin: 4px 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #666;
            border-radius: 8px;
            font-weight: 500;
        }

        .menu-group-title:hover {
            background: #E6F4FF;
            color: #0052CC;
        }

        .menu-group-title.active {
            background: #E6F4FF;
            color: #0052CC;
        }

        .menu-group-icon {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-arrow {
            font-size: 12px;
            transition: transform 0.3s;
        }

        .menu-arrow.expanded {
            transform: rotate(90deg);
        }

        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .submenu.expanded {
            max-height: 500px;
        }

        .submenu-item {
            padding: 10px 24px 10px 56px;
            margin: 2px 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            border-radius: 6px;
            font-size: 14px;
        }

        .submenu-item:hover {
            background: #E6F4FF;
            color: #0052CC;
        }

        .submenu-item.active {
            background: #0052CC;
            color: white;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .header {
            height: 64px;
            background: white;
            box-shadow: 0 1px 4px rgba(0,21,41,.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }

        .header-title {
            font-size: 18px;
            font-weight: 500;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #0052CC;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03);
        }

        .card-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        /* ç»Ÿè®¡å¡ç‰‡ - æ¸…çˆ½è“è‰²é£æ ¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: linear-gradient(135deg, #E6F4FF 0%, #ffffff 100%);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,82,204,0.08);
            border: 1px solid #E6F4FF;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #0052CC;
        }

        .stat-trend {
            font-size: 12px;
            color: #0052CC;
            margin-top: 8px;
        }

        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #0052CC;
            box-shadow: 0 0 0 2px rgba(0, 82, 204, 0.2);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* å›¾ç‰‡ç¼–è¾‘å™¨æ ·å¼ */
        .image-editor {
            margin-top: 20px;
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .image-item {
            position: relative;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            background: #f9f9f9;
        }

        .image-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }

        .image-controls {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
        }

        .image-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .image-btn:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .image-order {
            position: absolute;
            bottom: 5px;
            left: 5px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .add-image-btn {
            width: 100%;
            height: 150px;
            border: 2px dashed #d0d0d0;
            border-radius: 8px;
            background: #f9f9f9;
            color: #999;
            cursor: pointer;
            font-size: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .add-image-btn:hover {
            border-color: #0052CC;
            color: #0052CC;
            background: #f0f7ff;
        }

        /* æŒ‰é’®æ ·å¼ - æ·±è“è‰²ä¸»é¢˜ */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: #0052CC;
            color: white;
        }

        .btn-primary:hover {
            background: #0065FF;
            box-shadow: 0 4px 12px rgba(0,82,204,0.3);
        }

        .btn-success {
            background: #0052CC;
            color: white;
        }

        .btn-success:hover {
            background: #0065FF;
            box-shadow: 0 4px 12px rgba(0,82,204,0.3);
        }

        .btn-danger {
            background: #ff4d4f;
            color: white;
        }

        .btn-danger:hover {
            background: #ff7875;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        .table th {
            background: #fafafa;
            font-weight: 500;
            color: #333;
        }

        .table tr:hover {
            background: #fafafa;
        }

        /* æ ‡ç­¾æ ·å¼ */
        .tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
        }

        .tag-success {
            background: #f6ffed;
            color: #52c41a;
            border: 1px solid #b7eb8f;
        }

        .tag-warning {
            background: #fffbe6;
            color: #faad14;
            border: 1px solid #ffe58f;
        }

        .tag-danger {
            background: #fff2f0;
            color: #ff4d4f;
            border: 1px solid #ffccc7;
        }

        .tag-info {
            background: #E6F4FF;
            color: #0052CC;
            border: 1px solid #91d5ff;
        }

        /* å›¾ç‰‡é¢„è§ˆ */
        .image-preview {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .image-item {
            width: 100px;
            height: 100px;
            border-radius: 4px;
            object-fit: cover;
            border: 1px solid #d9d9d9;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 0;
            color: #999;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        /* iframeå®¹å™¨æ ·å¼ - æ— ç¼é›†æˆ */
        .iframe-container {
            width: 100%;
            height: calc(100vh - 64px);  /* å‡å»é¡¶éƒ¨å¯¼èˆªæ é«˜åº¦ */
            border: none;
            overflow: hidden;
            position: relative;
        }

        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
            background: #f0f2f5;
        }
    </style>
</head>
<body>
    <div id="app" class="app-container">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="logo">
                ğŸš€ æœ‹å‹åœˆå‘å¸ƒç³»ç»Ÿ
            </div>
            <div class="menu">
                <!-- è‡ªåŠ¨æ¨¡å¼ -->
                <div class="menu-item" :class="{active: currentPage === 'auto-workflow'}" @click="currentPage = 'auto-workflow'">
                    <span>è‡ªåŠ¨æ¨¡å¼</span>
                </div>

                <!-- æ‰‹åŠ¨æ¨¡å¼ -->
                <div class="menu-group">
                    <div class="menu-group-title" :class="{active: menuGroups.manual}" @click="toggleMenuGroup('manual')">
                        <div class="menu-group-icon">
                            <span>æ‰‹åŠ¨æ¨¡å¼</span>
                        </div>
                        <span class="menu-arrow" :class="{expanded: menuGroups.manual}">â–¶</span>
                    </div>
                    <div class="submenu" :class="{expanded: menuGroups.manual}">
                        <div class="submenu-item" :class="{active: currentPage === 'collection'}" @click="currentPage = 'collection'">
                            <span>å…¬ä¼—å·æå–</span>
                        </div>
                        <div class="submenu-item" :class="{active: currentPage === 'rewrite'}" @click="currentPage = 'rewrite'">
                            <span>æ–‡æ¡ˆè½¬å†™</span>
                        </div>
                        <div class="submenu-item" :class="{active: currentPage === 'publish'}" @click="currentPage = 'publish'">
                            <span>è‡ªåŠ¨å‘å¸ƒ</span>
                        </div>
                    </div>
                </div>

                <!-- å…¬ä¼—å·ç›‘æ§ -->
                <div class="menu-item" :class="{active: currentPage === 'wechat-monitor'}" @click="currentPage = 'wechat-monitor'">
                    <span>å…¬ä¼—å·ç›‘æ§</span>
                </div>

                <!-- ä»ªè¡¨ç›˜ -->
                <div class="menu-item" :class="{active: currentPage === 'dashboard'}" @click="currentPage = 'dashboard'">
                    <span>ä»ªè¡¨ç›˜</span>
                </div>

                <!-- å †é›ªçƒè´¦å·è®¾ç½® -->
                <div class="menu-item" :class="{active: currentPage === 'accounts'}" @click="currentPage = 'accounts'">
                    <span>å †é›ªçƒè´¦å·è®¾ç½®</span>
                </div>

                <!-- APIé…ç½® -->
                <div class="menu-group">
                    <div class="menu-group-title" :class="{active: menuGroups.api}" @click="toggleMenuGroup('api')">
                        <div class="menu-group-icon">
                            <span>APIé…ç½®</span>
                        </div>
                        <span class="menu-arrow" :class="{expanded: menuGroups.api}">â–¶</span>
                    </div>
                    <div class="submenu" :class="{expanded: menuGroups.api}">
                        <div class="submenu-item" :class="{active: currentPage === 'coze-config'}" @click="currentPage = 'coze-config'">
                            <span>Cozeé…ç½®</span>
                        </div>
                        <div class="submenu-item" :class="{active: currentPage === 'feishu-config'}" @click="currentPage = 'feishu-config'">
                            <span>é£ä¹¦å¤šç»´è¡¨æ ¼</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <div class="header">
                <div class="header-title">{{ pageTitle }}</div>
                <div class="user-info">
                    <span>{{ userName }}</span>
                    <div class="avatar">{{ userAvatar }}</div>
                    <button class="btn btn-logout" @click="handleLogout" style="margin-left: 12px; padding: 6px 12px; background: #ff4d4f; color: white; border: none; border-radius: 4px; cursor: pointer;">é€€å‡ºç™»å½•</button>
                </div>
            </div>

            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="content">
                <!-- ä»ªè¡¨ç›˜é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'dashboard'}">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">ä»Šæ—¥é‡‡é›†</div>
                            <div class="stat-value">23</div>
                            <div class="stat-trend">â†‘ 12% è¾ƒæ˜¨æ—¥</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ä»Šæ—¥æ”¹å†™</div>
                            <div class="stat-value">18</div>
                            <div class="stat-trend">â†‘ 8% è¾ƒæ˜¨æ—¥</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ä»Šæ—¥å‘å¸ƒ</div>
                            <div class="stat-value">15</div>
                            <div class="stat-trend">â†‘ 15% è¾ƒæ˜¨æ—¥</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">æ´»è·ƒè´¦å·</div>
                            <div class="stat-value">8</div>
                            <div class="stat-trend">å…±10ä¸ªè´¦å·</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">æœ€è¿‘å‘å¸ƒè®°å½•</div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>æ–‡æ¡ˆå†…å®¹</th>
                                    <th>å‘å¸ƒè´¦å·</th>
                                    <th>å‘å¸ƒæ—¶é—´</th>
                                    <th>çŠ¶æ€</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œé€‚åˆå‘æœ‹å‹åœˆï¼</td>
                                    <td>å¾®ä¿¡å·1</td>
                                    <td>2025-10-22 14:30</td>
                                    <td><span class="tag tag-success">å·²å‘å¸ƒ</span></td>
                                </tr>
                                <tr>
                                    <td>åˆ†äº«ä¸€ç¯‡å¥½æ–‡ç« ç»™å¤§å®¶</td>
                                    <td>å¾®ä¿¡å·2</td>
                                    <td>2025-10-22 13:15</td>
                                    <td><span class="tag tag-success">å·²å‘å¸ƒ</span></td>
                                </tr>
                                <tr>
                                    <td>å‘¨æœ«æ„‰å¿«ï¼</td>
                                    <td>å¾®ä¿¡å·3</td>
                                    <td>2025-10-22 10:00</td>
                                    <td><span class="tag tag-warning">å¾…å‘å¸ƒ</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- è‡ªåŠ¨æ¨¡å¼ - ä¸€é”®å‘å¸ƒé¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'auto-workflow'}">
                    <div class="card">
                        <div class="card-title">è‡ªåŠ¨æ¨¡å¼ - ä¸€é”®å‘å¸ƒ</div>
                        <div class="form-group">
                            <label class="form-label">å…¬ä¼—å·é“¾æ¥</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥å…¬ä¼—å·æ–‡ç« é“¾æ¥" v-model="autoForm.url">
                        </div>
                        <div class="form-group">
                            <label class="form-label">é€‰æ‹©å¾®ä¿¡è´¦å·</label>
                            <select class="form-input" v-model="autoForm.account">
                                <option value="">è¯·é€‰æ‹©å¾®ä¿¡è´¦å·</option>
                                <option value="wx1">å¾®ä¿¡å·1</option>
                                <option value="wx2">å¾®ä¿¡å·2</option>
                                <option value="wx3">å¾®ä¿¡å·3</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">å‘å¸ƒæ—¶é—´</label>
                            <input type="datetime-local" class="form-input" v-model="autoForm.time">
                        </div>
                        <button class="btn btn-primary" @click="startAutoWorkflow">ä¸€é”®å‘å¸ƒ</button>
                        <p style="margin-top: 12px; color: #666; font-size: 14px;">
                            ç³»ç»Ÿå°†è‡ªåŠ¨å®Œæˆï¼šé‡‡é›†æ–‡ç«  â†’ AIè½¬å†™ â†’ ä¸Šä¼ ç´ æ â†’ å®šæ—¶å‘å¸ƒ
                        </p>
                    </div>
                </div>

                <!-- å…¬ä¼—å·é‡‡é›†é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'collection'}">
                    <div class="card">
                        <div class="card-title">é‡‡é›†å…¬ä¼—å·æ–‡ç« </div>
                        <div class="form-group">
                            <label class="form-label">å…¬ä¼—å·æ–‡ç« é“¾æ¥</label>
                            <input type="text" class="form-input" v-model="collectionForm.url" placeholder="è¯·è¾“å…¥å…¬ä¼—å·æ–‡ç« é“¾æ¥">
                        </div>
                        <button class="btn btn-primary" @click="startCollection">å¼€å§‹é‡‡é›†</button>
                    </div>

                    <div class="card" v-if="collectionResult">
                        <div class="card-title">é‡‡é›†ç»“æœ</div>
                        <div class="form-group">
                            <label class="form-label">æ–‡ç« æ ‡é¢˜</label>
                            <div>{{ collectionResult.title }}</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ–‡ç« å†…å®¹</label>
                            <div>{{ collectionResult.content }}</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ–‡ç« å›¾ç‰‡</label>
                            <div class="image-preview">
                                <img v-for="img in collectionResult.images" :src="img" class="image-item">
                            </div>
                        </div>
                        <button class="btn btn-success" @click="goToRewrite">å»æ”¹å†™</button>
                    </div>
                </div>

                <!-- æ–‡æ¡ˆæ”¹å†™é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'rewrite'}">
                    <div class="card">
                        <div class="card-title">AIæ™ºèƒ½æ”¹å†™</div>
                        <div class="form-group">
                            <label class="form-label">åŸå§‹æ–‡æ¡ˆ</label>
                            <textarea class="form-input form-textarea" v-model="rewriteForm.original" placeholder="è¯·è¾“å…¥éœ€è¦æ”¹å†™çš„æ–‡æ¡ˆ"></textarea>
                        </div>

                        <!-- å›¾ç‰‡ç¼–è¾‘å™¨ -->
                        <div class="image-editor" v-if="rewriteForm.selectedImages.length > 0 || rewriteForm.images.length > 0">
                            <label class="form-label">æ–‡ç« å›¾ç‰‡ (å¯åˆ é™¤ã€æ’åºã€æ·»åŠ )</label>
                            <div class="image-gallery">
                                <!-- å·²é€‰æ‹©çš„å›¾ç‰‡ -->
                                <div v-for="(image, index) in rewriteForm.selectedImages" :key="index" class="image-item">
                                    <img :src="image" :alt="'å›¾ç‰‡' + (index + 1)">
                                    <div class="image-controls">
                                        <button class="image-btn" @click="moveImageUp(index)" :disabled="index === 0" title="ä¸Šç§»">â†‘</button>
                                        <button class="image-btn" @click="moveImageDown(index)" :disabled="index === rewriteForm.selectedImages.length - 1" title="ä¸‹ç§»">â†“</button>
                                        <button class="image-btn" @click="removeImage(index)" title="åˆ é™¤">Ã—</button>
                                    </div>
                                    <div class="image-order">{{ index + 1 }}</div>
                                </div>
                                <!-- æ·»åŠ æ–°å›¾ç‰‡æŒ‰é’® -->
                                <div class="add-image-btn" @click="showAddImageMenu" title="æ·»åŠ å›¾ç‰‡">
                                    +
                                </div>
                            </div>
                            <!-- éšè—çš„æ–‡ä»¶ä¸Šä¼ è¾“å…¥æ¡† -->
                            <input type="file" ref="imageUpload" @change="handleImageUpload" accept="image/*" style="display: none;">
                        </div>

                        <button class="btn btn-primary" @click="startRewrite" style="margin-top: 20px;">å¼€å§‹æ”¹å†™</button>
                    </div>

                    <div class="card" v-if="rewriteResult">
                        <div class="card-title">æ”¹å†™ç»“æœ</div>
                        <div class="form-group">
                            <label class="form-label">æ”¹å†™ç‰ˆæœ¬1</label>
                            <textarea v-model="rewriteResult.version1" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ”¹å†™ç‰ˆæœ¬2</label>
                            <textarea v-model="rewriteResult.version2" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ”¹å†™ç‰ˆæœ¬3</label>
                            <textarea v-model="rewriteResult.version3" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-success" @click="goToPublish(1)">ä½¿ç”¨ç‰ˆæœ¬1å‘å¸ƒ</button>
                            <button class="btn btn-success" @click="goToPublish(2)">ä½¿ç”¨ç‰ˆæœ¬2å‘å¸ƒ</button>
                            <button class="btn btn-success" @click="goToPublish(3)">ä½¿ç”¨ç‰ˆæœ¬3å‘å¸ƒ</button>
                        </div>
                    </div>
                </div>

                <!-- å‘å¸ƒç®¡ç†é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'publish'}">
                    <!-- åˆ›å»ºå‘å¸ƒä»»åŠ¡ -->
                    <div class="card">
                        <div class="card-title">åˆ›å»ºå‘å¸ƒä»»åŠ¡</div>

                        <div class="form-group">
                            <label class="form-label">ä»»åŠ¡æ ‡é¢˜</label>
                            <input type="text" class="form-input" v-model="publishForm.taskTitle" placeholder="è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜(å¯é€‰)">
                        </div>

                        <div class="form-group">
                            <label class="form-label">æ–‡æ¡ˆå†…å®¹</label>
                            <textarea class="form-input form-textarea" v-model="publishForm.content" placeholder="è¯·è¾“å…¥è¦å‘å¸ƒçš„æ–‡æ¡ˆ" rows="6"></textarea>
                        </div>

                        <!-- å›¾ç‰‡é¢„è§ˆ -->
                        <div class="form-group" v-if="publishForm.images && publishForm.images.length > 0">
                            <label class="form-label">æœ‹å‹åœˆå›¾ç‰‡ ({{ publishForm.images.length }}å¼ )</label>
                            <div class="image-preview" style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <img v-for="(img, index) in publishForm.images" :key="index" :src="img"
                                     style="width: 100px; height: 100px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">é€‰æ‹©å¾®ä¿¡è´¦å·</label>
                            <select class="form-input" v-model="publishForm.account">
                                <option value="">è¯·é€‰æ‹©è´¦å·</option>
                                <option value="lifangde002">lifangde002 (å †é›ªçƒè´¦å·)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">å‘å¸ƒæ–¹å¼</label>
                            <div style="display: flex; gap: 20px; margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" v-model="publishForm.isImmediate" :value="true" style="margin-right: 8px;">
                                    <span>ç«‹å³å‘å¸ƒ</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" v-model="publishForm.isImmediate" :value="false" style="margin-right: 8px;">
                                    <span>å®šæ—¶å‘å¸ƒ</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group" v-if="!publishForm.isImmediate">
                            <label class="form-label">å‘å¸ƒæ—¶é—´</label>
                            <input type="datetime-local" class="form-input" v-model="publishForm.publishTime">
                        </div>

                        <div class="form-group" v-if="!publishForm.isImmediate">
                            <label class="form-label">éšæœºå»¶è¿Ÿ (åˆ†é’Ÿ)</label>
                            <input type="number" class="form-input" v-model.number="publishForm.randomDelay"
                                   placeholder="0-60åˆ†é’Ÿ" min="0" max="60">
                            <p style="margin-top: 8px; color: #666; font-size: 12px;">
                                è®¾ç½®éšæœºå»¶è¿Ÿå¯ä»¥è®©å‘å¸ƒæ—¶é—´æ›´è‡ªç„¶,é¿å…è¢«æ£€æµ‹ä¸ºæœºå™¨äºº
                            </p>
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" @click="createPublishTask" :disabled="publishTaskCreating">
                                {{ publishTaskCreating ? 'åˆ›å»ºä¸­...' : 'åˆ›å»ºä»»åŠ¡' }}
                            </button>
                            <button class="btn" @click="resetPublishForm" style="background: #f0f0f0; color: #666;">
                                é‡ç½®è¡¨å•
                            </button>
                        </div>
                    </div>

                    <!-- ä»»åŠ¡åˆ—è¡¨ -->
                    <div class="card">
                        <div class="card-title" style="display: flex; justify-content: space-between; align-items: center;">
                            <span>å‘å¸ƒä»»åŠ¡åˆ—è¡¨</span>
                            <button class="btn btn-primary" @click="loadPublishTasks" style="padding: 6px 12px; font-size: 14px;">
                                åˆ·æ–°åˆ—è¡¨
                            </button>
                        </div>

                        <div v-if="publishTasksLoading" style="text-align: center; padding: 40px; color: #666;">
                            åŠ è½½ä¸­...
                        </div>

                        <div v-else-if="publishTasks.length === 0" style="text-align: center; padding: 40px; color: #999;">
                            æš‚æ— å‘å¸ƒä»»åŠ¡
                        </div>

                        <table class="table" v-else>
                            <thead>
                                <tr>
                                    <th>ä»»åŠ¡æ ‡é¢˜</th>
                                    <th>æ–‡æ¡ˆå†…å®¹</th>
                                    <th>å›¾ç‰‡</th>
                                    <th>å¾®ä¿¡è´¦å·</th>
                                    <th>å‘å¸ƒæ—¶é—´</th>
                                    <th>çŠ¶æ€</th>
                                    <th>åˆ›å»ºæ—¶é—´</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="task in publishTasks" :key="task.id">
                                    <td>{{ task.task_title || 'æ— æ ‡é¢˜' }}</td>
                                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                        {{ task.content }}
                                    </td>
                                    <td>
                                        <span v-if="task.images && task.images.length > 0">
                                            {{ task.images.length }}å¼ 
                                        </span>
                                        <span v-else style="color: #999;">æ— å›¾ç‰‡</span>
                                    </td>
                                    <td>{{ task.wechat_account || '-' }}</td>
                                    <td>
                                        <span v-if="task.is_immediate" style="color: #52c41a;">ç«‹å³å‘å¸ƒ</span>
                                        <span v-else>{{ formatDateTime(task.publish_time) }}</span>
                                    </td>
                                    <td>
                                        <span class="tag" :class="{
                                            'tag-warning': task.status === 'pending',
                                            'tag-info': task.status === 'processing',
                                            'tag-success': task.status === 'completed',
                                            'tag-danger': task.status === 'failed'
                                        }">
                                            {{ getStatusText(task.status) }}
                                        </span>
                                    </td>
                                    <td>{{ formatDateTime(task.created_at) }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- å¾®ä¿¡è´¦å·é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'accounts'}">
                    <div class="card">
                        <div class="card-title">å¾®ä¿¡è´¦å·åˆ—è¡¨</div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>è´¦å·åç§°</th>
                                    <th>å¾®ä¿¡ID</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æœ€åå‘å¸ƒ</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>å¾®ä¿¡å·1</td>
                                    <td>wxid_123456</td>
                                    <td><span class="tag tag-success">æ­£å¸¸</span></td>
                                    <td>2025-10-22 14:30</td>
                                    <td><button class="btn btn-primary">ç¼–è¾‘</button></td>
                                </tr>
                                <tr>
                                    <td>å¾®ä¿¡å·2</td>
                                    <td>wxid_789012</td>
                                    <td><span class="tag tag-success">æ­£å¸¸</span></td>
                                    <td>2025-10-22 13:15</td>
                                    <td><button class="btn btn-primary">ç¼–è¾‘</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Cozeé…ç½®é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'coze-config'}">
                    <div class="card">
                        <div class="card-title">Coze APIé…ç½®</div>
                        <div class="form-group">
                            <label class="form-label">Coze API Token</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥Coze API Token" v-model="cozeConfig.token">
                        </div>
                        <div class="form-group">
                            <label class="form-label">é‡‡é›†å·¥ä½œæµID</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥å…¬ä¼—å·é‡‡é›†å·¥ä½œæµID" v-model="cozeConfig.collectionWorkflowId">
                        </div>
                        <div class="form-group">
                            <label class="form-label">è½¬å†™å·¥ä½œæµID</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥æ–‡æ¡ˆè½¬å†™å·¥ä½œæµID" v-model="cozeConfig.rewriteWorkflowId">
                        </div>
                        <button class="btn btn-primary" @click="saveCozeConfig">ä¿å­˜é…ç½®</button>
                    </div>
                </div>

                <!-- é£ä¹¦å¤šç»´è¡¨æ ¼é…ç½®é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'feishu-config'}">
                    <div class="card">
                        <div class="card-title">é£ä¹¦å¤šç»´è¡¨æ ¼é…ç½®</div>
                        <div class="form-group">
                            <label class="form-label">é£ä¹¦åº”ç”¨ID (App ID)</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥é£ä¹¦åº”ç”¨ID" v-model="feishuConfig.appId">
                        </div>
                        <div class="form-group">
                            <label class="form-label">é£ä¹¦åº”ç”¨å¯†é’¥ (App Secret)</label>
                            <input type="password" class="form-input" placeholder="è¯·è¾“å…¥é£ä¹¦åº”ç”¨å¯†é’¥" v-model="feishuConfig.appSecret">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å¤šç»´è¡¨æ ¼ID</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥å¤šç»´è¡¨æ ¼ID" v-model="feishuConfig.tableId">
                        </div>
                        <button class="btn btn-primary" @click="saveFeishuConfig">ä¿å­˜é…ç½®</button>
                    </div>
                </div>

                <!-- å…¬ä¼—å·ç›‘æ§é¡µé¢ - iframeåµŒå…¥ -->
                <div class="page" :class="{active: currentPage === 'wechat-monitor'}">
                    <div class="iframe-container">
                        <iframe src="wechat-subscription.html" frameborder="0"></iframe>
                    </div>
                </div>

                <!-- ç³»ç»Ÿè®¾ç½®é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'settings'}">
                    <div class="card">
                        <div class="card-title">ç³»ç»Ÿé…ç½®</div>
                        <div class="form-group">
                            <label class="form-label">Coze APIå¯†é’¥</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥Coze APIå¯†é’¥">
                        </div>
                        <div class="form-group">
                            <label class="form-label">é£ä¹¦åº”ç”¨ID</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥é£ä¹¦åº”ç”¨ID">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å †é›ªçƒè´¦å·</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥å †é›ªçƒè´¦å·">
                        </div>
                        <button class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentPage: 'auto-workflow',
                    userName: 'åˆ€ä»”è€æ¿',
                    userAvatar: 'åˆ€',
                    menuGroups: {
                        auto: false,
                        manual: false,
                        api: false
                    },
                    collectionForm: {
                        url: ''
                    },
                    collectionResult: null,
                    rewriteForm: {
                        articleId: null,
                        original: '',
                        images: [],  // åŸå§‹å›¾ç‰‡åˆ—è¡¨
                        selectedImages: []  // ç”¨æˆ·é€‰æ‹©çš„å›¾ç‰‡åˆ—è¡¨
                    },
                    rewriteResult: null,
                    publishForm: {
                        taskTitle: '',
                        content: '',
                        images: [],
                        account: '',
                        isImmediate: true,
                        publishTime: '',
                        randomDelay: 0
                    },
                    publishTasks: [],
                    publishTasksLoading: false,
                    publishTaskCreating: false,
                    autoForm: {
                        url: '',
                        account: '',
                        time: ''
                    },
                    cozeConfig: {
                        token: '',
                        collectionWorkflowId: '',
                        rewriteWorkflowId: ''
                    },
                    feishuConfig: {
                        appId: '',
                        appSecret: '',
                        tableId: ''
                    },
                    // å…¬ä¼—å·ç›‘æ§ç›¸å…³æ•°æ®
                    wechatMonitor: {
                        activeTab: 'articles',
                        loading: false,
                        subscriptions: [],
                        articles: [],
                        selectedMp: null,
                        totalArticles: 0,
                        allArticlesCount: 0,
                        qrCodeUrl: '',
                        qrStatus: 'ç‚¹å‡»æŒ‰é’®è·å–äºŒç»´ç ',
                        qrCheckInterval: null,
                        searchKeyword: '',
                        searchResults: [],
                        selectedMpData: null,
                        newSubscription: {
                            name: '',
                            mp_id: '',
                            description: ''
                        },
                        syncInterval: 30,
                        showArticleModal: false,
                        currentArticle: null
                    },
                    apiBaseUrl: 'http://localhost:3000/api',
                    rssApiUrl: 'http://localhost:8001/api/v1/wx'
                }
            },
            computed: {
                pageTitle() {
                    const titles = {
                        dashboard: 'ä»ªè¡¨ç›˜',
                        'auto-workflow': 'è‡ªåŠ¨æ¨¡å¼ - ä¸€é”®å‘å¸ƒ',
                        'wechat-monitor': 'å…¬ä¼—å·ç›‘æ§',
                        collection: 'æ‰‹åŠ¨æ¨¡å¼ - å…¬ä¼—å·æå–',
                        rewrite: 'æ‰‹åŠ¨æ¨¡å¼ - æ–‡æ¡ˆè½¬å†™',
                        publish: 'æ‰‹åŠ¨æ¨¡å¼ - è‡ªåŠ¨å‘å¸ƒ',
                        accounts: 'å †é›ªçƒè´¦å·è®¾ç½®',
                        'coze-config': 'APIé…ç½® - Coze',
                        'feishu-config': 'APIé…ç½® - é£ä¹¦å¤šç»´è¡¨æ ¼',
                        settings: 'ç³»ç»Ÿè®¾ç½®'
                    };
                    return titles[this.currentPage] || 'æœ‹å‹åœˆå‘å¸ƒç³»ç»Ÿ';
                }
            },
            methods: {
                toggleMenuGroup(groupName) {
                    this.menuGroups[groupName] = !this.menuGroups[groupName];
                },
                startCollection() {
                    // æ¨¡æ‹Ÿé‡‡é›†ç»“æœ
                    this.collectionResult = {
                        title: 'è¿™æ˜¯ä¸€ç¯‡å…¬ä¼—å·æ–‡ç« æ ‡é¢˜',
                        content: 'è¿™æ˜¯æ–‡ç« çš„å†…å®¹æ‘˜è¦...',
                        images: [
                            'https://via.placeholder.com/100',
                            'https://via.placeholder.com/100'
                        ]
                    };
                },
                goToRewrite() {
                    this.currentPage = 'rewrite';
                    this.rewriteForm.original = this.collectionResult.content;
                },
                async startRewrite() {
                    if (!this.rewriteForm.original) {
                        alert('è¯·å…ˆè¾“å…¥éœ€è¦æ”¹å†™çš„æ–‡æ¡ˆ');
                        return;
                    }

                    try {
                        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                        this.rewriteResult = {
                            version1: 'æ­£åœ¨è°ƒç”¨Coze AIç”Ÿæˆç‰ˆæœ¬1...',
                            version2: 'æ­£åœ¨è°ƒç”¨Coze AIç”Ÿæˆç‰ˆæœ¬2...',
                            version3: 'æ­£åœ¨è°ƒç”¨Coze AIç”Ÿæˆç‰ˆæœ¬3...'
                        };

                        const response = await fetch(`${this.apiBaseUrl}/coze/rewrite`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify({
                                content: this.rewriteForm.original,
                                images: this.rewriteForm.selectedImages,
                                articleId: this.rewriteForm.articleId
                            })
                        });

                        const data = await response.json();

                        if (data.success) {
                            this.rewriteResult = {
                                version1: data.data.version1,
                                version2: data.data.version2,
                                version3: data.data.version3
                            };
                            alert('è½¬å†™æˆåŠŸ!å·²ç”Ÿæˆ3ä¸ªç‰ˆæœ¬çš„æ–‡æ¡ˆ,æ‚¨å¯ä»¥ç¼–è¾‘åé€‰æ‹©ä½¿ç”¨!');
                        } else {
                            alert('è½¬å†™å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                            this.rewriteResult = {
                                version1: '',
                                version2: '',
                                version3: ''
                            };
                        }
                    } catch (error) {
                        console.error('è½¬å†™å¤±è´¥:', error);
                        alert('è½¬å†™å¤±è´¥: ' + error.message);
                        this.rewriteResult = {
                            version1: '',
                            version2: '',
                            version3: ''
                        };
                    }
                },
                goToPublish(version = 1) {
                    this.currentPage = 'publish';
                    // æ ¹æ®é€‰æ‹©çš„ç‰ˆæœ¬è®¾ç½®å‘å¸ƒå†…å®¹
                    if (version === 1) {
                        this.publishForm.content = this.rewriteResult.version1;
                    } else if (version === 2) {
                        this.publishForm.content = this.rewriteResult.version2;
                    } else if (version === 3) {
                        this.publishForm.content = this.rewriteResult.version3;
                    }
                    // åŒæ—¶è®¾ç½®å›¾ç‰‡
                    this.publishForm.images = this.rewriteForm.selectedImages || [];
                },
                async createPublishTask() {
                    // éªŒè¯è¡¨å•
                    if (!this.publishForm.content.trim()) {
                        alert('è¯·è¾“å…¥æ–‡æ¡ˆå†…å®¹');
                        return;
                    }
                    if (!this.publishForm.account) {
                        alert('è¯·é€‰æ‹©å¾®ä¿¡è´¦å·');
                        return;
                    }
                    if (!this.publishForm.isImmediate && !this.publishForm.publishTime) {
                        alert('è¯·é€‰æ‹©å‘å¸ƒæ—¶é—´');
                        return;
                    }

                    this.publishTaskCreating = true;

                    try {
                        const token = localStorage.getItem('token');
                        const user = JSON.parse(localStorage.getItem('user') || '{}');

                        // å‡†å¤‡å‘å¸ƒæ—¶é—´
                        let publishTime;
                        if (this.publishForm.isImmediate) {
                            publishTime = new Date().toISOString();
                        } else {
                            publishTime = new Date(this.publishForm.publishTime).toISOString();
                        }

                        const response = await fetch('http://localhost:3000/api/api/publish/create', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify({
                                userId: user.id,
                                taskTitle: this.publishForm.taskTitle || 'æœ‹å‹åœˆå‘å¸ƒä»»åŠ¡',
                                content: this.publishForm.content,
                                images: this.publishForm.images,
                                wechatAccount: this.publishForm.account,
                                publishTime: publishTime,
                                isImmediate: this.publishForm.isImmediate,
                                randomDelayMinutes: this.publishForm.randomDelay || 0
                            })
                        });

                        const result = await response.json();

                        if (response.ok) {
                            alert('å‘å¸ƒä»»åŠ¡åˆ›å»ºæˆåŠŸï¼');
                            // é‡ç½®è¡¨å•
                            this.resetPublishForm();
                            // åˆ·æ–°ä»»åŠ¡åˆ—è¡¨
                            await this.loadPublishTasks();
                        } else {
                            alert('åˆ›å»ºå¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯'));
                        }
                    } catch (error) {
                        console.error('åˆ›å»ºå‘å¸ƒä»»åŠ¡å¤±è´¥:', error);
                        alert('åˆ›å»ºå¤±è´¥: ' + error.message);
                    } finally {
                        this.publishTaskCreating = false;
                    }
                },
                resetPublishForm() {
                    this.publishForm = {
                        taskTitle: '',
                        content: '',
                        images: [],
                        account: '',
                        isImmediate: true,
                        publishTime: '',
                        randomDelay: 0
                    };
                },
                async loadPublishTasks() {
                    this.publishTasksLoading = true;
                    try {
                        const token = localStorage.getItem('token');
                        const user = JSON.parse(localStorage.getItem('user') || '{}');

                        console.log('å¼€å§‹åŠ è½½ä»»åŠ¡åˆ—è¡¨, userId:', user.id);

                        const response = await fetch(`http://localhost:3000/api/api/publish/tasks?userId=${user.id}`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        console.log('APIå“åº”çŠ¶æ€:', response.status);
                        const result = await response.json();
                        console.log('APIå“åº”æ•°æ®:', result);

                        if (response.ok) {
                            // APIè¿”å›çš„æ•°æ®ç»“æ„æ˜¯ {success: true, data: {tasks: [...], total: ...}}
                            this.publishTasks = result.data?.tasks || result.data || [];
                            console.log('âœ… åŠ è½½ä»»åŠ¡åˆ—è¡¨æˆåŠŸ, ä»»åŠ¡æ•°é‡:', this.publishTasks.length);
                            console.log('ä»»åŠ¡åˆ—è¡¨:', this.publishTasks);
                        } else {
                            console.error('âŒ åŠ è½½ä»»åŠ¡åˆ—è¡¨å¤±è´¥:', result.message);
                            this.publishTasks = [];
                        }
                    } catch (error) {
                        console.error('âŒ åŠ è½½ä»»åŠ¡åˆ—è¡¨å¼‚å¸¸:', error);
                        this.publishTasks = [];
                    } finally {
                        this.publishTasksLoading = false;
                    }
                },
                formatDateTime(dateString) {
                    if (!dateString) return '-';
                    const date = new Date(dateString);
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    const hours = String(date.getHours()).padStart(2, '0');
                    const minutes = String(date.getMinutes()).padStart(2, '0');
                    return `${year}-${month}-${day} ${hours}:${minutes}`;
                },
                getStatusText(status) {
                    const statusMap = {
                        'pending': 'å¾…å‘å¸ƒ',
                        'processing': 'å‘å¸ƒä¸­',
                        'completed': 'å·²å®Œæˆ',
                        'failed': 'å¤±è´¥'
                    };
                    return statusMap[status] || status;
                },
                handleLogout() {
                    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—?')) {
                        // æ¸…é™¤ç™»å½•ä¿¡æ¯
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                        // è·³è½¬åˆ°ç™»å½•é¡µé¢
                        window.location.href = 'login.html';
                    }
                },
                startAutoWorkflow() {
                    if (!this.autoForm.url) {
                        alert('è¯·è¾“å…¥å…¬ä¼—å·é“¾æ¥');
                        return;
                    }
                    if (!this.autoForm.account) {
                        alert('è¯·é€‰æ‹©å¾®ä¿¡è´¦å·');
                        return;
                    }
                    if (!this.autoForm.time) {
                        alert('è¯·é€‰æ‹©å‘å¸ƒæ—¶é—´');
                        return;
                    }
                    alert('ä¸€é”®å‘å¸ƒä»»åŠ¡å·²åˆ›å»ºï¼ç³»ç»Ÿå°†è‡ªåŠ¨å®Œæˆé‡‡é›†ã€è½¬å†™ã€ä¸Šä¼ ã€å‘å¸ƒæµç¨‹ã€‚');
                },
                saveCozeConfig() {
                    // TODO: è°ƒç”¨åç«¯APIä¿å­˜é…ç½®
                    alert('Cozeé…ç½®ä¿å­˜æˆåŠŸï¼');
                },
                saveFeishuConfig() {
                    // TODO: è°ƒç”¨åç«¯APIä¿å­˜é…ç½®
                    alert('é£ä¹¦é…ç½®ä¿å­˜æˆåŠŸï¼');
                },
                // å…¬ä¼—å·ç›‘æ§ç›¸å…³æ–¹æ³•
                async searchWechatAccount() {
                    if (!this.wechatMonitor.searchKeyword) {
                        alert('è¯·è¾“å…¥å…¬ä¼—å·åç§°');
                        return;
                    }

                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch(`http://localhost:3000/api/wechat-monitor/search?keyword=${encodeURIComponent(this.wechatMonitor.searchKeyword)}`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            this.wechatMonitor.searchResults = data;
                            if (data.length === 0) {
                                alert('æœªæ‰¾åˆ°ç›¸å…³å…¬ä¼—å·');
                            }
                        } else {
                            alert('æœç´¢å¤±è´¥ï¼');
                        }
                    } catch (error) {
                        console.error('æœç´¢å¤±è´¥:', error);
                        alert('æœç´¢å¤±è´¥ï¼');
                    }
                },
                async selectAccount(account) {
                    if (!confirm(`ç¡®å®šè¦è®¢é˜…"${account.mp_name}"å—ï¼Ÿ`)) {
                        return;
                    }

                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch('http://localhost:3000/api/wechat-monitor/subscriptions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify({
                                mp_name: account.mp_name,
                                mp_id: account.mp_id,
                                mp_cover: account.mp_cover,
                                avatar: account.avatar,
                                mp_intro: account.mp_intro
                            })
                        });

                        if (response.ok) {
                            alert('æ·»åŠ è®¢é˜…æˆåŠŸï¼');
                            this.wechatMonitor.searchKeyword = '';
                            this.wechatMonitor.searchResults = [];
                            this.loadSubscriptions();
                        } else {
                            alert('æ·»åŠ è®¢é˜…å¤±è´¥ï¼');
                        }
                    } catch (error) {
                        console.error('æ·»åŠ è®¢é˜…å¤±è´¥:', error);
                        alert('æ·»åŠ è®¢é˜…å¤±è´¥ï¼');
                    }
                },
                async loadSubscriptions() {
                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch('http://localhost:3000/api/wechat-monitor/subscriptions', {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            this.wechatMonitor.subscriptions = data;
                        }
                    } catch (error) {
                        console.error('åŠ è½½è®¢é˜…åˆ—è¡¨å¤±è´¥:', error);
                    }
                },
                async deleteSubscription(id) {
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¢é˜…å—ï¼Ÿ')) {
                        return;
                    }

                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch(`http://localhost:3000/api/wechat-monitor/subscriptions/${id}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            alert('åˆ é™¤æˆåŠŸï¼');
                            this.loadSubscriptions();
                        } else {
                            alert('åˆ é™¤å¤±è´¥ï¼');
                        }
                    } catch (error) {
                        console.error('åˆ é™¤è®¢é˜…å¤±è´¥:', error);
                        alert('åˆ é™¤å¤±è´¥ï¼');
                    }
                },
                async triggerUpdate(id) {
                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch(`http://localhost:3000/api/wechat-monitor/subscriptions/${id}/update`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            alert('æ›´æ–°æˆåŠŸï¼');
                            this.loadSubscriptions();
                        } else {
                            alert('æ›´æ–°å¤±è´¥ï¼');
                        }
                    } catch (error) {
                        console.error('è§¦å‘æ›´æ–°å¤±è´¥:', error);
                        alert('æ›´æ–°å¤±è´¥ï¼');
                    }
                },
                async loadArticles() {
                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch('http://localhost:3000/api/wechat-monitor/articles', {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            this.wechatMonitor.articles = data;
                        }
                    } catch (error) {
                        console.error('åŠ è½½æ–‡ç« åˆ—è¡¨å¤±è´¥:', error);
                    }
                },
                viewArticle(id) {
                    alert(`æŸ¥çœ‹æ–‡ç« è¯¦æƒ…: ${id}`);
                },
                openWechatMonitor() {
                    // è·³è½¬åˆ°æ–°çš„å…¬ä¼—å·ç›‘æ§é¡µé¢
                    window.location.href = 'wechat-subscription.html';
                },
                openArticles() {
                    // è·³è½¬åˆ°æ–‡ç« ç®¡ç†é¡µé¢
                    window.location.href = 'articles.html';
                },
                openMonitorConfig() {
                    // è·³è½¬åˆ°ç›‘æ§é…ç½®é¡µé¢
                    window.location.href = 'monitor-config.html';
                },
                // å¤„ç†æ¥è‡ªiframeçš„æ¶ˆæ¯
                handleMessage(event) {
                    // å®‰å…¨æ£€æŸ¥:ç¡®ä¿æ¶ˆæ¯æ¥è‡ªå¯ä¿¡æº
                    // åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥æ£€æŸ¥event.origin

                    if (event.data && event.data.action === 'goToRewrite') {
                        // ä»localStorageè·å–è½¬å†™æ•°æ®
                        const rewriteData = JSON.parse(localStorage.getItem('rewriteData') || '{}');

                        if (rewriteData.content) {
                            // å¡«å……è½¬å†™è¡¨å•
                            this.rewriteForm.articleId = rewriteData.articleId;
                            this.rewriteForm.original = rewriteData.content;
                            this.rewriteForm.images = rewriteData.images || [];
                            this.rewriteForm.selectedImages = [...(rewriteData.images || [])];  // é»˜è®¤é€‰ä¸­æ‰€æœ‰å›¾ç‰‡

                            // åˆ‡æ¢åˆ°è½¬å†™é¡µé¢
                            this.currentPage = 'rewrite';
                            this.menuGroups.manual = true;  // å±•å¼€æ‰‹åŠ¨æ¨¡å¼èœå•
                        }
                    }
                },
                // åˆ é™¤å›¾ç‰‡
                removeImage(index) {
                    this.rewriteForm.selectedImages.splice(index, 1);
                },
                // ä¸Šç§»å›¾ç‰‡
                moveImageUp(index) {
                    if (index > 0) {
                        const temp = this.rewriteForm.selectedImages[index];
                        this.rewriteForm.selectedImages[index] = this.rewriteForm.selectedImages[index - 1];
                        this.rewriteForm.selectedImages[index - 1] = temp;
                    }
                },
                // ä¸‹ç§»å›¾ç‰‡
                moveImageDown(index) {
                    if (index < this.rewriteForm.selectedImages.length - 1) {
                        const temp = this.rewriteForm.selectedImages[index];
                        this.rewriteForm.selectedImages[index] = this.rewriteForm.selectedImages[index + 1];
                        this.rewriteForm.selectedImages[index + 1] = temp;
                    }
                },
                // æ˜¾ç¤ºæ·»åŠ å›¾ç‰‡èœå•
                showAddImageMenu() {
                    const choice = confirm('ç‚¹å‡»"ç¡®å®š"ä¸Šä¼ æœ¬åœ°å›¾ç‰‡\nç‚¹å‡»"å–æ¶ˆ"è¾“å…¥å›¾ç‰‡URL');
                    if (choice) {
                        // ä¸Šä¼ æœ¬åœ°å›¾ç‰‡
                        this.triggerImageUpload();
                    } else {
                        // è¾“å…¥URL
                        this.addImageUrl();
                    }
                },
                // è§¦å‘æ–‡ä»¶ä¸Šä¼ 
                triggerImageUpload() {
                    this.$refs.imageUpload.click();
                },
                // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
                handleImageUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                    if (!file.type.startsWith('image/')) {
                        alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶!');
                        return;
                    }

                    // æ£€æŸ¥æ–‡ä»¶å¤§å°(é™åˆ¶5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB!');
                        return;
                    }

                    // ä½¿ç”¨FileReaderè¯»å–å›¾ç‰‡å¹¶è½¬æ¢ä¸ºBase64
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        // æ·»åŠ Base64å›¾ç‰‡åˆ°åˆ—è¡¨
                        this.rewriteForm.selectedImages.push(e.target.result);
                    };
                    reader.onerror = () => {
                        alert('å›¾ç‰‡è¯»å–å¤±è´¥,è¯·é‡è¯•!');
                    };
                    reader.readAsDataURL(file);

                    // æ¸…ç©ºinput,å…è®¸é‡å¤é€‰æ‹©åŒä¸€æ–‡ä»¶
                    event.target.value = '';
                },
                // æ·»åŠ å›¾ç‰‡URL(ä¿ç•™æ­¤æ–¹æ³•,å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼è°ƒç”¨)
                addImageUrl() {
                    const url = prompt('è¯·è¾“å…¥å›¾ç‰‡URL:');
                    if (url && url.trim()) {
                        this.rewriteForm.selectedImages.push(url.trim());
                    }
                }
            },
            mounted() {
                // æ£€æŸ¥ç™»å½•çŠ¶æ€
                const token = localStorage.getItem('token');
                if (!token) {
                    // æœªç™»å½•,è·³è½¬åˆ°ç™»å½•é¡µé¢
                    window.location.href = 'login.html';
                    return;
                }

                // è·å–ç”¨æˆ·ä¿¡æ¯
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                if (user.name) {
                    this.userName = user.name;
                    this.userAvatar = user.name.charAt(0);
                }

                // åŠ è½½å…¬ä¼—å·ç›‘æ§æ•°æ®
                this.loadSubscriptions();
                this.loadArticles();

                // åŠ è½½å‘å¸ƒä»»åŠ¡åˆ—è¡¨
                this.loadPublishTasks();

                // ç›‘å¬æ¥è‡ªiframeçš„æ¶ˆæ¯
                window.addEventListener('message', this.handleMessage);
            },
            beforeUnmount() {
                // ç§»é™¤æ¶ˆæ¯ç›‘å¬å™¨
                window.removeEventListener('message', this.handleMessage);
            }
        }).mount('#app');
    </script>
</body>
</html>

